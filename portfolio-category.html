<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>JUNJUN摄影 - 作品集分类</title>
        <!-- 预加载关键资源 -->
        <link rel="preconnect" href="https://cdn.tailwindcss.com">
        <link rel="preconnect" href="https://cdn.jsdelivr.net">
        <link rel="preconnect" href="https://cdnjs.cloudflare.com">
        
        <!-- 核心脚本 -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- 使用更稳定的 lucide 图标库 CDN 链接 -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
        
        <!-- 延迟加载非关键脚本 -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0F;
            color: #fff;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }

        .hero-section {
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hero-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            position: relative;
            background-color: #0A0A0F;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        .nav-link {
            position: relative;
            transition: color 0.3s;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            transition: width 0.3s;
        }

        .nav-link:hover::after, .nav-link.active::after {
            width: 100%;
        }

        .navbar-fixed {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .btn-primary {
            background-color: transparent;
            color: #fff;
            border: 1px solid #fff;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background-color: #fff;
            color: #000;
        }

        /* 网格画廊布局样式 */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .portfolio-item {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 3/2; /* 设置3:2的横图比例 */
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .portfolio-item.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .portfolio-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            /* 渐进式加载效果 */
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .portfolio-item:hover img {
            transform: scale(1.05);
        }

        .portfolio-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding: 2rem;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            pointer-events: none; /* 确保overlay不拦截鼠标事件 */
        }

        .portfolio-title, .portfolio-caption {
            pointer-events: none; /* 确保文字也不拦截鼠标事件 */
        }

        .portfolio-item:hover .portfolio-overlay {
            transform: translateY(0);
        }

        .portfolio-title {
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .portfolio-caption {
            color: white;
            font-size: 0.875rem;
        }

        /* 响应式设计 */
        @media (max-width: 1024px) and (min-width: 769px) {
            .fullscreen-viewer-content {
                width: 96%;
                max-height: 88vh;
                padding: 1.25rem;
            }

            .fullscreen-viewer-image-container {
                height: calc(100% - 70px);
                min-height: 180px;
            }


        }

        @media (max-width: 768px) {
            .fullscreen-viewer-content {
                width: 98%;
                max-height: 85vh;
                padding: 1rem;
                margin: 0 auto;
            }

            .fullscreen-viewer-image-container {
                height: calc(100% - 60px);
                min-height: 150px;
                margin-bottom: 0.5rem;
            }



            .fullscreen-viewer-info {
                max-height: none;
                padding-top: 0.5rem;
                min-height: 50px;
            }

            #fullscreen-title {
                font-size: 14px;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
                line-height: 1.3;
            }

            #fullscreen-caption {
                font-size: 12px;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
                max-height: none;
            }
        }

        /* 触摸滑动支持 */
        .fullscreen-viewer-image-container {
            touch-action: none;
            overflow: hidden;
            position: relative;
        }

        .fullscreen-viewer-image {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-origin: center center;
            cursor: zoom-in;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            will-change: transform;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .fullscreen-viewer-image.zoomed {
            cursor: grab;
        }

        .fullscreen-viewer-image.dragging {
            cursor: grabbing;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-50px); opacity: 0; }
        }

        /* 优化的弹窗动画效果 */
        @keyframes slideInFromClick {
            from { 
                transform: translate(-50%, -50%) scale(0.9); 
                opacity: 0; 
            }
            to { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 1; 
            }
        }

        @keyframes slideOutFromClick {
            from { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 1; 
            }
            to { 
                transform: translate(-50%, -50%) scale(0.8); 
                opacity: 0; 
            }
        }

        /* 背景遮罩淡入淡出动画 */
        @keyframes backdropFadeIn {
            from { background-color: rgba(0, 0, 0, 0); }
            to { background-color: rgba(0, 0, 0, 0.8); }
        }

        @keyframes backdropFadeOut {
            from { background-color: rgba(0, 0, 0, 0.8); }
            to { background-color: rgba(0, 0, 0, 0); }
        }

        .fullscreen-viewer-image.slide-in {
            animation: slideIn 0.3s ease;
        }

        .fullscreen-viewer-image.slide-out {
            animation: slideOut 0.3s ease;
        }
    </style>
</head>
<body class="bg-[#0A0A0F] text-white flex flex-col min-h-screen">



    <!-- Hero Section -->
    <section id="home" class="hero-section">
        <div id="hero-image" class="hero-slide active">
            <!-- Image will be set by JavaScript -->
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <h1 id="category-title" class="font-bold mb-4 opacity-0" style="transform: translateY(50px); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: clamp(2rem, 8vw, 4rem);">作品集分类</h1>
            <p id="category-description" class="text-xl md:text-2xl mb-8 opacity-0" style="transform: translateY(50px);">探索我的摄影作品集，捕捉每一个精彩瞬间。</p>
            <a href="index.html#portfolio" class="back-link opacity-0" style="transform: translateY(50px);">
                <i data-lucide="arrow-left"></i>
                <span>返回作品集</span>
            </a>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-20 flex-grow">
        <div class="container mx-auto px-4">
            <!-- Search Bar Component -->
            <div class="search-container mb-10">
                <div class="relative max-w-2xl mx-auto">
                    <input type="text" id="search-input" placeholder="输入你想看的..." class="w-full px-6 py-4 bg-[#1A1A2E] border border-[#3A3A5E] rounded-full text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white transition-shadow duration-300 ease-in-out">
                    <button id="search-reset" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-[#3A3A5E] hover:bg-[#4A4A6E] text-white rounded-full p-2 transition-all duration-300 opacity-0 invisible">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <p id="search-results" class="text-center text-gray-400 mt-3 hidden"></p>
            </div>
            
            <div class="portfolio-grid" id="portfolio-grid">
                <!-- Portfolio items will be dynamically generated by JavaScript -->
            </div>
        </div>
    </section>

    <style>
        /* 作品集网格布局 */
        .portfolio-grid {
            display: grid;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .portfolio-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .portfolio-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1025px) {
            .portfolio-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* 图片占位符样式 */
        .image-placeholder {
            background-color: #1a1a2e;
            background-image: linear-gradient(135deg, #1a1a2e 25%, #16213e 25%, #16213e 50%, #1a1a2e 50%, #1a1a2e 75%, #16213e 75%, #16213e 100%);
            background-size: 40px 40px;
            animation: placeholdershine 2s linear infinite;
        }

        @keyframes placeholdershine {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        /* 优化动画性能 */
        .transition-transform {
            will-change: transform;
        }

        .hero-slide, .hero-content h1, .hero-content p {
            will-change: opacity, transform;
        }

        /* 减少重排和重绘 */
        .category-card, .nav-link {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* 优化滚动性能 */
        html {
            scroll-behavior: smooth;
        }

        /* 优化字体渲染 */
        body {
            font-synthesis: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 返回链接样式优化 */
        .back-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            border-radius: 0.375rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.5;
            min-width: auto;
            margin: 0;
            position: relative;
            overflow: hidden;
        }

        .back-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .back-link:active {
            transform: translateY(0);
        }

        .back-link svg {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
            margin: 0;
            transition: transform 0.2s ease;
        }

        .back-link:hover svg {
            transform: translateX(-2px);
        }

        .back-link span {
            margin: 0;
            padding: 0;
            white-space: nowrap;
            font-size: 1rem;
            line-height: 1.5;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .back-link {
                padding: 0.625rem 1.25rem;
                font-size: 0.875rem;
                gap: 0.375rem;
            }
            
            .back-link svg {
                width: 1.125rem;
                height: 1.125rem;
            }
            
            .back-link span {
                font-size: 0.875rem;
            }
        }

        @media (max-width: 480px) {
            .back-link {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
                gap: 0.25rem;
            }
            
            .back-link svg {
                width: 1rem;
                height: 1rem;
            }
            
            .back-link span {
                font-size: 0.8rem;
            }
        }

        /* 图片查看器弹窗样式 */
        .fullscreen-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(15px);
        }

        .fullscreen-viewer.active {
            display: block;
        }

        .fullscreen-viewer-content {
                position: absolute;
                width: 90%;
                max-width: 1200px;
                max-height: 90vh;
                background: rgba(20, 20, 20, 0.85);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                padding: 1.5rem;
                box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);
                display: flex;
                flex-direction: column;
                animation: slideInFromClick 0.3s ease;
                transform: translateX(-50%) scale(0.8);
                opacity: 0;
                will-change: transform, opacity, left, top;
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }

        .fullscreen-viewer-image-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 0.75rem;
            min-height: 200px;
            width: 100%;
            /* 优化高度设置，根据图片比例自适应 */
            height: auto;
            max-height: calc(100% - 60px);
            min-height: 250px;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            /* 确保图片容器充分利用空间 */
            max-width: 100%;
            /* 添加弹性布局支持，让图片根据内容自适应 */
            flex-grow: 1;
            flex-shrink: 1;
        }

        .fullscreen-viewer-image {
            /* 优化图片显示设置 - 充分利用弹窗空间 */
            max-width: 98%;
            max-height: 98%;
            width: auto;
            height: auto;
            object-fit: contain;
            object-position: center center;
            transition: transform 0.3s ease;
            border-radius: 6px;
            display: block;
            margin: auto;
            position: relative; /* 改为相对定位，让容器自动调整 */
            /* 移除绝对定位限制，让图片根据内容自适应 */
            top: auto;
            left: auto;
            right: auto;
            bottom: auto;
            /* 确保图片在容器内居中显示 */
            transform-origin: center center;
            /* 防止图片被拉伸或裁切 */
            aspect-ratio: auto;
            /* 添加弹性布局支持 */
            flex-shrink: 0;
        }
        
        /* 导航提示元素样式 */
        .fullscreen-nav-hint {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }
        
        /* 左侧提示 */
        .fullscreen-nav-hint-prev {
            left: 10px;
        }
        
        /* 右侧提示 */
        .fullscreen-nav-hint-next {
            right: 10px;
        }
        
        /* 鼠标悬停在左侧20%区域时显示上一张提示 */
        .fullscreen-viewer-image-container:hover .fullscreen-nav-hint-prev {
            opacity: 1;
        }
        
        /* 鼠标悬停在右侧20%区域时显示下一张提示 */
        .fullscreen-viewer-image-container:hover .fullscreen-nav-hint-next {
            opacity: 1;
        }



        .fullscreen-viewer-info {
            text-align: center;
            color: white;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            max-height: none;
            overflow: visible;
            min-height: 60px;
        }

        #fullscreen-index {
            display: block;
            font-size: 12px;
            margin-bottom: 6px;
            color: #ccc;
        }

        #fullscreen-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            overflow: visible;
            text-overflow: unset;
            white-space: normal;
            word-wrap: break-word;
            word-break: break-word;
            line-height: 1.4;
        }

        #fullscreen-caption {
            font-size: 13px;
            color: #ccc;
            margin: 0;
            line-height: 1.4;
            display: block;
            overflow: visible;
            white-space: normal;
            word-wrap: break-word;
            word-break: break-word;
            max-height: none;
        }

        /* 响应式设计 - 确保不同设备完美适配 */
        
        /* 高分辨率桌面设备 (1440px+) */
        @media (min-width: 1440px) {
            .fullscreen-viewer-content {
                width: 92%;
                max-width: 1400px;
                max-height: 92vh;
                padding: 2rem;
            }

            .fullscreen-viewer-image-container {
                min-height: 300px;
                max-height: calc(100% - 80px);
            }

            .fullscreen-viewer-image {
                max-width: 99%;
                max-height: 99%;
            }

            /* 高DPI设备优化 */
            @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
                .fullscreen-viewer-image {
                    image-rendering: -webkit-optimize-contrast;
                    image-rendering: crisp-edges;
                }
            }
        }

        /* 标准桌面设备 (1025px - 1439px) */
        @media (max-width: 1439px) and (min-width: 1025px) {
            .fullscreen-viewer-content {
                width: 94%;
                max-width: 1200px;
                max-height: 90vh;
                padding: 1.5rem;
            }

            .fullscreen-viewer-image-container {
                min-height: 280px;
                max-height: calc(100% - 70px);
            }
        }

        /* 平板设备 (769px - 1024px) */
        @media (max-width: 1024px) and (min-width: 769px) {
            .fullscreen-viewer-content {
                width: 96%;
                max-height: 88vh;
                padding: 1.25rem;
                margin: 0 auto;
            }

            .fullscreen-viewer-image-container {
                height: auto;
                max-height: calc(100% - 60px);
                min-height: 200px;
                margin-bottom: 0.75rem;
            }

            .fullscreen-viewer-nav {
                width: 44px;
                height: 44px;
            }

            .fullscreen-viewer-nav.prev {
                left: -22px;
            }

            .fullscreen-viewer-nav.next {
                right: -22px;
            }

            .fullscreen-viewer-close {
                top: 12px;
                right: 12px;
                width: 36px;
                height: 36px;
                font-size: 20px;
            }

            .fullscreen-viewer-info {
                padding-top: 0.75rem;
                min-height: 55px;
            }

            #fullscreen-title {
                font-size: 15px;
                line-height: 1.35;
            }

            #fullscreen-caption {
                font-size: 12.5px;
                line-height: 1.35;
            }
        }

        /* 手机设备 (768px及以下) */
        @media (max-width: 768px) {
            .fullscreen-viewer-content {
                width: 98%;
                max-height: 85vh;
                padding: 1rem;
                margin: 0 auto;
                /* 手机端优化：减少边距，增加可用空间 */
                border-radius: 8px;
            }

            .fullscreen-viewer-image-container {
                height: auto;
                max-height: calc(100% - 50px);
                min-height: 180px;
                margin-bottom: 0.5rem;
                /* 手机端优化：增加触摸区域 */
                border-radius: 4px;
            }

            .fullscreen-viewer-nav {
                width: 40px;
                height: 40px;
                /* 手机端优化：增大触摸区域 */
                min-width: 40px;
                min-height: 40px;
            }

            .fullscreen-viewer-nav.prev {
                left: -20px;
            }

            .fullscreen-viewer-nav.next {
                right: -20px;
            }

            .fullscreen-viewer-close {
                top: 10px;
                right: 10px;
                width: 32px;
                height: 32px;
                font-size: 18px;
                /* 手机端优化：增大触摸区域 */
                min-width: 32px;
                min-height: 32px;
            }

            .fullscreen-viewer-info {
                max-height: none;
                padding-top: 0.5rem;
                min-height: 50px;
                /* 手机端优化：减少信息区域高度 */
                border-top: 1px solid rgba(255, 255, 255, 0.08);
            }

            #fullscreen-title {
                font-size: 14px;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
                line-height: 1.3;
                margin-bottom: 0.25rem;
            }

            #fullscreen-caption {
                font-size: 12px;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
                max-height: none;
                line-height: 1.3;
            }
        }

        /* 超小屏幕手机 (480px及以下) */
        @media (max-width: 480px) {
            .fullscreen-viewer-content {
                width: 99%;
                max-height: 82vh;
                padding: 0.75rem;
                border-radius: 6px;
            }

            .fullscreen-viewer-image-container {
                height: auto;
                max-height: calc(100% - 45px);
                min-height: 150px;
                margin-bottom: 0.4rem;
            }

            .fullscreen-viewer-nav {
                width: 36px;
                height: 36px;
                min-width: 36px;
                min-height: 36px;
            }



            .fullscreen-viewer-info {
                padding-top: 0.4rem;
                min-height: 45px;
            }

            #fullscreen-title {
                font-size: 13px;
                margin-bottom: 0.2rem;
            }

            #fullscreen-caption {
                font-size: 11px;
            }
        }

        /* 超宽屏设备 (1920px+) */
        @media (min-width: 1920px) {
            .fullscreen-viewer-content {
                width: 90%;
                max-width: 1600px;
                max-height: 94vh;
                padding: 2.5rem;
            }

            .fullscreen-viewer-image-container {
                min-height: 350px;
                max-height: calc(100% - 90px);
            }

            .fullscreen-viewer-image {
                max-width: 99.5%;
                max-height: 99.5%;
            }
        }

        /* 折叠屏设备适配 */
        @media (max-width: 768px) and (max-height: 600px) {
            .fullscreen-viewer-content {
                max-height: 88vh;
                padding: 0.5rem;
            }

            .fullscreen-viewer-image-container {
                max-height: calc(100% - 40px);
                min-height: 120px;
            }

            .fullscreen-viewer-info {
                min-height: 35px;
                padding-top: 0.3rem;
            }

            #fullscreen-title {
                font-size: 12px;
                margin-bottom: 0.1rem;
            }

            #fullscreen-caption {
                font-size: 10px;
            }
        }

        /* 横屏模式优化 */
        @media (max-width: 1024px) and (orientation: landscape) {
            .fullscreen-viewer-content {
                max-height: 90vh;
                width: 95%;
            }

            .fullscreen-viewer-image-container {
                max-height: calc(100% - 50px);
            }

            .fullscreen-viewer-info {
                min-height: 40px;
            }
        }

        /* 竖屏模式优化 */
        @media (max-width: 768px) and (orientation: portrait) {
            .fullscreen-viewer-content {
                max-height: 80vh;
            }

            .fullscreen-viewer-image-container {
                max-height: calc(100% - 55px);
            }
        }

        /* 触摸滑动支持 */
        .fullscreen-viewer-image-container {
            touch-action: none;
            overflow: hidden;
            position: relative;
        }

        .fullscreen-viewer-image {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-origin: center center;
            cursor: zoom-in;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            will-change: transform;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .fullscreen-viewer-image.zoomed {
            cursor: grab;
        }

        .fullscreen-viewer-image.dragging {
            cursor: grabbing;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }



        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-50px); opacity: 0; }
        }

        .fullscreen-viewer-image.slide-in {
            animation: slideIn 0.3s ease;
        }

        .fullscreen-viewer-image.slide-out {
            animation: slideOut 0.3s ease;
        }
    </style>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full bg-[#0A0A0F] bg-opacity-70 z-50 py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold">JUNJUN</a>
            <div class="hidden md:flex space-x-8">
                <a href="index.html#home" class="nav-link">首页</a>
                <a href="index.html#portfolio" class="nav-link active">作品集</a>
                <a href="index.html#about" class="nav-link">关于我</a>
                <a href="index.html#contact" class="nav-link">联系方式</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden">
                <i data-lucide="menu"></i>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden absolute top-full right-0 min-w-fit bg-[#0A0A0F] bg-opacity-70 backdrop-filter blur(10px) -webkit-backdrop-filter blur(10px) py-4 px-6 shadow-lg rounded-lg">
            <div class="flex flex-col space-y-4">
                <a href="index.html#home" class="mobile-nav-link">首页</a>
                <a href="index.html#portfolio" class="mobile-nav-link">作品集</a>
                <a href="index.html#about" class="mobile-nav-link">关于我</a>
                <a href="index.html#contact" class="mobile-nav-link">联系方式</a>
            </div>
        </div>
    </nav>

    <script>
        // 初始化 Lucide 图标
        function initLucideIcons() {
            lucide.createIcons();
        }
        initLucideIcons();

        /**
         * 防抖函数，用于优化滚动事件
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ------------------------------------------------------
        // Mobile Menu Functionality
        // ------------------------------------------------------
        function initMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        }

        // ------------------------------------------------------
        // 导航栏滚动效果
        // ------------------------------------------------------
        const nav = document.querySelector('nav');
        window.addEventListener('scroll', debounce(() => {
            // 在滚动时应用导航栏模糊效果
            if (window.scrollY > 50) {
                nav.classList.add('navbar-fixed');
            } else {
                nav.classList.remove('navbar-fixed');
            }
        }, 100));

        // ------------------------------------------------------
        // Category Handling
        // ------------------------------------------------------

        /**
         * 从 URL 查询参数中获取分类。
         * @returns {string} 分类名称。如果未找到，则默认为 'shantou_main'。
         */
        function getCategoryFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('category') || 'shantou_main';
        }

        // ------------------------------------------------------
        // Portfolio Data
        // ------------------------------------------------------
        // 创建本地图片数据URI（避免外部链接问题）
        function createImagePlaceholder(width, height, text, bgColor = '#4A5568', textColor = '#FFFFFF') {
            const canvas = document.createElement('canvas');
            // 增加图片尺寸以适应弹窗显示
            canvas.width = width * 2;  // 增加到1600px宽度
            canvas.height = height * 2; // 增加到1200px高度
            const ctx = canvas.getContext('2d');
            
            // 绘制背景
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制文字
            ctx.fillStyle = textColor;
            ctx.font = 'bold 48px Arial'; // 增大字体以适应更大尺寸
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            
            return canvas.toDataURL('image/png');
        }

        // 作品集数据 - 从JSON文件动态加载
        let portfolioData = {};
        let isDataLoaded = false;

        // 加载作品集数据
        async function loadPortfolioData() {
            try {
                const response = await fetch('portfolio-data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                portfolioData = await response.json();
                isDataLoaded = true;
                return portfolioData;
            } catch (error) {
                console.error('Error loading portfolio data:', error);
                // 使用备用数据作为回退
                portfolioData = getFallbackPortfolioData();
                isDataLoaded = true;
                return portfolioData;
            }
        }

        // 备用数据（回退机制）
        function getFallbackPortfolioData() {
            return {
                shantou_main: {
                    title: "汕大本部",
                    description: "记录汕头大学本部的美丽风光与人文气息，一草一木皆入画。",
                    headerImage: createImagePlaceholder(1200, 600, "汕大本部"),
                    images: [
                        {
                            src: createImagePlaceholder(800, 600, "汕大图书馆", "#4B5563"),
                            alt: "汕大图书馆",
                            caption: "标志性的图书馆建筑"
                        }
                    ]
                },
                shantou_east: {
                    title: "汕大东校区",
                    description: "记录汕头大学东校区的现代建筑与自然环境",
                    headerImage: createImagePlaceholder(1200, 600, "汕大东校区风光", "#4B5563"),
                    images: [
                        {
                            src: createImagePlaceholder(800, 600, "汕大东校区校门", "#4B5563"),
                            alt: "汕大东校区校门",
                            caption: "汕大东校区现代风格校门"
                        }
                    ]
                },
                cats: {
                    title: "猫咪",
                    description: "记录校园中可爱的猫咪们，它们是校园中最受欢迎的小生命。",
                    headerImage: createImagePlaceholder(1200, 600, "猫咪摄影", "#4B5563"),
                    images: [
                        {
                            src: createImagePlaceholder(800, 600, "橘猫", "#4B5563"),
                            alt: "橘猫",
                            caption: "校园里最常见的橘猫"
                        }
                    ]
                }
            };
        }

        // 初始化页面 - 加载数据并填充内容
        async function initPage() {
            try {
                // 初始化移动端菜单
                initMobileMenu();
                
                // 显示加载状态
                const portfolioGrid = document.getElementById('portfolio-grid');
                if (portfolioGrid) {
                    portfolioGrid.innerHTML = `
                        <div class="flex items-center justify-center h-64">
                            <div class="text-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"></div>
                                <p class="text-gray-600">加载中...</p>
                            </div>
                        </div>
                    `;
                }

                // 加载数据
                await loadPortfolioData();
                
                // 填充页面内容
                populatePortfolio();
                
                // 初始化图片查看器
                initFullscreenViewer(); // 初始化全屏查看器
                
            } catch (error) {
                console.error('Error initializing page:', error);
                
                // 显示错误状态
                const portfolioGrid = document.getElementById('portfolio-grid');
                if (portfolioGrid) {
                    portfolioGrid.innerHTML = `
                        <div class="flex items-center justify-center h-64">
                            <div class="text-center">
                                <p class="text-red-600 mb-4">加载失败，请刷新页面重试</p>
                                <button onclick="window.location.reload()" class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition">
                                    刷新页面
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);

        // ------------------------------------------------------
        // Portfolio Population
        // ------------------------------------------------------

        /**
         * 根据所选分类填充页面内容。
         * 这包括更新英雄区和生成作品集项目。
         */
        function populatePortfolio() {
            const category = getCategoryFromUrl();
            const categoryData = portfolioData[category];
            
            if (!categoryData) {
                console.error('Category not found');
                return;
            }

            // Update hero section
            const heroImage = document.getElementById('hero-image');
            const categoryTitle = document.getElementById('category-title');
            const categoryDescription = document.getElementById('category-description');
            const backLink = document.querySelector('.back-link');
            
            const headerImg = document.createElement('img');
            headerImg.src = categoryData.headerImage;
            headerImg.alt = categoryData.title;
            headerImg.className = 'w-full h-full object-cover';
            headerImg.loading = 'lazy';
            // 添加图片错误处理
            headerImg.onerror = function() {
                this.src = createImagePlaceholder(1200, 600, categoryData.title);
            };
            heroImage.appendChild(headerImg);
            
            categoryTitle.textContent = categoryData.title;
            categoryDescription.textContent = categoryData.description;

            // Animate hero content
            gsap.to(categoryTitle, {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.5
            });
            gsap.to(categoryDescription, {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.8
            });
            gsap.to(backLink, {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 1.1
            });

            // 渲染作品集项目
            renderPortfolioItems(categoryData.images);
            
            // 初始化搜索功能
            initSearchFunctionality(categoryData.images);
        }
        
        /**
         * 渲染作品集项目
         * @param {Array} images 要渲染的图片数组
         */
        function renderPortfolioItems(images) {
            // 保存当前滚动位置
            const scrollPosition = window.scrollY;
            
            // Generate portfolio items with original sorting
            const portfolioGrid = document.getElementById('portfolio-grid');
            portfolioGrid.innerHTML = '';

            // 预加载图片到缓存
            function preloadImages(imagesToPreload) {
                imagesToPreload.forEach(image => {
                    // 检查缓存中是否已有该图片
                    const cache = imageCacheManager.getCache();
                    if (cache[image.src] && cache[image.src].data === 'loaded') {
                        return;
                    }
                    
                    const img = new Image();
                    img.src = image.src;
                    
                    if (img.complete) {
                        // 图片已缓存，直接使用
                        imageCacheManager.setCache(image.src, 'loaded');
                        return;
                    }
                    
                    img.onload = function() {
                        // 图片加载成功，添加到缓存
                        imageCacheManager.setCache(image.src, 'loaded');
                    };
                    
                    img.onerror = function() {
                        // 图片加载失败，记录错误信息
                        imageCacheManager.setCache(image.src, 'error');
                        console.warn(`图片加载失败: ${image.src}`);
                    };
                });
            }

            // 开始预加载图片
            preloadImages(images);

            images.forEach((image, index) => {
                const delay = 0.1 * index;
                const portfolioItem = document.createElement('div');
                portfolioItem.className = 'portfolio-item';
                
                portfolioItem.innerHTML = `
                    <img src="${image.src}" alt="${image.alt}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105 cursor-pointer" loading="lazy" onerror="this.src='${createImagePlaceholder(800, 600, image.alt)}'">
                    <div class="portfolio-overlay">
                        <h3 class="portfolio-title">${image.alt}</h3>
                        <p class="portfolio-caption">${image.caption}</p>
                    </div>
                `;
                
                portfolioGrid.appendChild(portfolioItem);
                
                // 添加点击事件监听器
                const imgElement = portfolioItem.querySelector('img');
                imgElement.addEventListener('click', function() {
                    window.openFullscreenViewer(images, index, imgElement);
                });
                
                // Animate items with stagger effect
                gsap.to(portfolioItem, {
                    opacity: 1,
                    y: 0,
                    delay: delay,
                    duration: 0.8,
                    ease: "power2.out",
                    onComplete: function() {
                        portfolioItem.classList.add('visible');
                    }
                });
            });
            
            // 恢复滚动位置
            setTimeout(() => {
                window.scrollTo(0, scrollPosition);
            }, 0);
        }

        /**
         * 初始化搜索功能
         * @param {Array} allImages 当前分类下的所有图片
         */
        function initSearchFunctionality(allImages) {
            const searchInput = document.getElementById('search-input');
            const searchReset = document.getElementById('search-reset');
            const searchResults = document.getElementById('search-results');
            
            // 防抖函数
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const context = this;
                    const later = () => {
                        clearTimeout(timeout);
                        func.apply(context, args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // 搜索输入事件监听（带防抖）
            const handleSearchInput = debounce(function() {
                const keyword = this.value.trim().toLowerCase();
                
                // 过滤图片
                const filteredImages = filterImages(allImages, keyword);
                
                // 更新搜索结果显示
                updateSearchResults(filteredImages.length, keyword);
                
                // 渲染过滤后的图片
                renderPortfolioItems(filteredImages);
            }, 300); // 300毫秒防抖延迟
            
            // 立即处理重置按钮显示状态的事件监听
            searchInput.addEventListener('input', function() {
                const keyword = this.value.trim().toLowerCase();
                
                // 更新重置按钮的显示状态
                if (keyword) {
                    searchReset.classList.remove('opacity-0', 'invisible');
                    searchReset.classList.add('opacity-100', 'visible');
                } else {
                    searchReset.classList.remove('opacity-100', 'visible');
                    searchReset.classList.add('opacity-0', 'invisible');
                    searchResults.classList.add('hidden');
                    // 显示所有图片
                    renderPortfolioItems(allImages);
                    return;
                }
                
                // 调用防抖处理函数
                handleSearchInput.call(this);
            });
            
            // 重置按钮点击事件
            searchReset.addEventListener('click', function() {
                searchInput.value = '';
                searchReset.classList.remove('opacity-100', 'visible');
                searchReset.classList.add('opacity-0', 'invisible');
                searchResults.classList.add('hidden');
                // 显示所有图片
                renderPortfolioItems(allImages);
            });
        }
        
        /**
         * 根据关键词过滤图片
         * @param {Array} images 图片数组
         * @param {string} keyword 搜索关键词
         * @returns {Array} 过滤后的图片数组
         */
        function filterImages(images, keyword) {
            return images.filter(image => {
                const title = image.alt ? image.alt.toLowerCase() : '';
                const caption = image.caption ? image.caption.toLowerCase() : '';
                return title.includes(keyword) || caption.includes(keyword);
            });
        }
        
        /**
         * 更新搜索结果显示
         * @param {number} count 匹配的图片数量
         * @param {string} keyword 搜索关键词
         */
        function updateSearchResults(count, keyword) {
            const searchResults = document.getElementById('search-results');
            searchResults.classList.remove('hidden');
            
            if (count === 0) {
                searchResults.textContent = `未找到包含"${keyword}"的作品`;
                searchResults.classList.add('text-red-400');
                searchResults.classList.remove('text-gray-400');
            } else {
                searchResults.textContent = `找到 ${count} 个包含"${keyword}"的作品`;
                searchResults.classList.remove('text-red-400');
                searchResults.classList.add('text-gray-400');
            }
        }





        // ------------------------------------------------------
        // Smooth Scrolling for Navigation
        // ------------------------------------------------------
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80, // Offset for navbar
                        behavior: 'smooth'
                    });
                    
                    // Close mobile menu if open
                    if (!mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            });
        });

        // ------------------------------------------------------
        // Active Navigation and Navbar Effects
        // ------------------------------------------------------
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            const nav = document.querySelector('nav');

            let currentSection = '';

            // Determine which section is currently in view
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;

                if (window.pageYOffset >= sectionTop - 200) {
                    currentSection = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSection}`) {
                    link.classList.add('active');
                }
            });

            // Apply navbar blur effect on scroll
            if (window.scrollY > 50) {
                nav.classList.add('navbar-fixed');
            } else {
                nav.classList.remove('navbar-fixed');
            }
        });

        // ------------------------------------------------------
        // 图片缓存管理
        // ------------------------------------------------------
        
        /**
         * 图片缓存管理器
         */
        const imageCacheManager = {
            // 缓存存储键名
            cacheKey: 'portfolio_image_cache',
            
            // 缓存过期时间（30天）
            cacheExpiry: 30 * 24 * 60 * 60 * 1000,
            
            /**
             * 获取缓存数据
             */
            getCache: function() {
                try {
                    const cacheData = localStorage.getItem(this.cacheKey);
                    if (cacheData) {
                        const parsed = JSON.parse(cacheData);
                        // 检查缓存是否过期
                        if (Date.now() - parsed.timestamp < this.cacheExpiry) {
                            return parsed.data;
                        }
                    }
                } catch (e) {
                    console.warn('图片缓存读取失败:', e);
                }
                return {};
            },
            
            /**
             * 设置缓存数据
             */
            setCache: function(url, data) {
                try {
                    const cache = this.getCache() || {};
                    cache[url] = {
                        data: data,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(this.cacheKey, JSON.stringify({
                        data: cache,
                        timestamp: Date.now()
                    }));
                } catch (e) {
                    console.warn('图片缓存写入失败:', e);
                }
            },
            
            /**
             * 清除过期缓存
             */
            clearExpiredCache: function() {
                try {
                    const cacheData = localStorage.getItem(this.cacheKey);
                    if (cacheData) {
                        const parsed = JSON.parse(cacheData);
                        if (Date.now() - parsed.timestamp > this.cacheExpiry) {
                            localStorage.removeItem(this.cacheKey);
                        }
                    }
                } catch (e) {
                    console.warn('清除缓存失败:', e);
                }
            }
        };

        // ------------------------------------------------------
        // 页面初始化
        // ------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            // 清除过期缓存
            imageCacheManager.clearExpiredCache();
            
            // 启用图片懒加载
            if ('IntersectionObserver' in window) {
                const lazyImages = document.querySelectorAll('img[loading="lazy"]');
                
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src || img.src;
                            img.classList.remove('lazy');
                            imageObserver.unobserve(img);
                        }
                    });
                });
                
                lazyImages.forEach(img => {
                    imageObserver.observe(img);
                });
            }
            
            // 优化低端设备性能
            optimizePerformance();
        });

        /**
         * 优化性能，特别是在低端设备上
         */
        function optimizePerformance() {
            // 检测设备性能
            const isLowEndDevice = (function() {
                // 简单的性能检测
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (!gl) {
                    return true; // 不支持WebGL，可能是低端设备
                }
                
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (!debugInfo) {
                    return false;
                }
                
                const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL).toLowerCase();
                // 检测常见的低端设备GPU
                const lowEndGPUs = ['intel hd graphics 3000', 'intel hd graphics 4000', 'radeon hd 6000', 'geforce 9400m'];
                
                return lowEndGPUs.some(gpu => renderer.includes(gpu));
            })();
            
            // 如果是低端设备，禁用一些动画效果
            if (isLowEndDevice) {
                document.body.classList.add('low-end-device');
                
                // 简化CSS动画
                const style = document.createElement('style');
                style.textContent = `
                    .low-end-device * {
                        animation-duration: 0.1s !important;
                        transition-duration: 0.1s !important;
                    }
                    
                    .low-end-device .portfolio-overlay {
                        transform: translateY(0) !important;
                        background: rgba(0,0,0,0.6) !important;
                    }
                `;
                document.head.appendChild(style);
            }
        }

        /**
         * 初始化全屏图片查看器功能
         * 该功能允许用户点击图片后在全屏模式下查看，并支持缩放、拖拽、导航等交互
         */
        function initFullscreenViewer() {
            // 获取查看器相关DOM元素
            const fullscreenViewer = document.getElementById('fullscreen-viewer');
            const fullscreenImage = document.getElementById('fullscreen-image');
            const fullscreenTitle = document.getElementById('fullscreen-title');
            const fullscreenCaption = document.getElementById('fullscreen-caption');
            const fullscreenIndex = document.getElementById('fullscreen-index');
            const viewerContent = document.querySelector('.fullscreen-viewer-content');
            
            // 状态变量
            let currentImages = []; // 当前查看的图片数组
            let currentIndex = 0; // 当前图片索引
            let touchStartX = 0; // 触摸开始X坐标
            let touchEndX = 0; // 触摸结束X坐标
            let scale = 1; // 缩放比例
            let isZoomed = false; // 是否已缩放
            let initialDistance = 0; // 初始触摸距离（用于双指缩放）
            let translateX = 0; // X轴偏移量
            let translateY = 0; // Y轴偏移量
            let isDragging = false; // 是否正在拖拽
            let dragStartX = 0; // 拖拽开始X坐标
            let dragStartY = 0; // 拖拽开始Y坐标
            let dragStartTranslateX = 0; // 拖拽开始时的X偏移量
            let dragStartTranslateY = 0; // 拖拽开始时的Y偏移量
            let animationFrameId = null; // 动画帧ID
            
            /**
             * 打开查看器 - 基于视口的动态定位系统
             * @param {Array} images 图片数组
             * @param {number} index 当前图片索引
             * @param {HTMLElement} clickedElement 被点击的元素
             */
            window.openFullscreenViewer = function(images, index, clickedElement) {
                currentImages = images;
                currentIndex = index;
                
                const viewerContent = document.querySelector('.fullscreen-viewer-content');
                
                // 记录当前滚动位置，以便关闭时恢复
                window.savedScrollPosition = {
                    x: window.scrollX,
                    y: window.scrollY
                };
                
                // 重置所有样式，避免之前的动画影响
                viewerContent.style.transition = '';
                viewerContent.style.transform = '';
                viewerContent.style.opacity = '';
                viewerContent.style.left = '';
                viewerContent.style.top = '';
                
                // 获取视口尺寸和滚动位置
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const scrollX = window.scrollX;
                const scrollY = window.scrollY;
                
                // 计算弹窗在视口中的居中位置
                const centerX = scrollX + viewportWidth / 2;
                const centerY = scrollY + viewportHeight / 2;
                
                // 设置弹窗最终位置（视口中心）
                viewerContent.style.left = centerX + 'px';
                viewerContent.style.top = centerY + 'px';
                
                // 设置初始样式（从0.9缩放开始，淡入效果）
                viewerContent.style.transform = 'translate(-50%, -50%) scale(0.9)';
                viewerContent.style.opacity = '0';
                
                // 显示查看器
                fullscreenViewer.classList.add('active');
                
                // 禁止页面滚动
                document.body.style.overflow = 'hidden';
                
                // 延迟一帧后开始动画，确保样式已应用
                requestAnimationFrame(() => {
                    // 移动到视口中心并放大到1（淡入效果）
                    viewerContent.style.transform = 'translate(-50%, -50%) scale(1)';
                    viewerContent.style.opacity = '1';
                    viewerContent.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease';
                });
                
                // 更新查看器内容
                updateViewer();
                
                // 添加缩放功能事件监听
                addZoomListeners();
            };
            
            // 添加缩放功能事件监听
            function addZoomListeners() {
                // 鼠标滚轮缩放（基于指针位置）
                fullscreenImage.addEventListener('wheel', handleWheelZoom, { passive: false });
                
                // 鼠标拖拽功能
                fullscreenImage.addEventListener('mousedown', handleMouseDown);
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                
                // 移动端双指缩放
                fullscreenImage.addEventListener('touchstart', handleTouchStartZoom, { passive: false });
                fullscreenImage.addEventListener('touchmove', handleTouchMoveZoom, { passive: false });
                fullscreenImage.addEventListener('touchend', handleTouchEndZoom);
                
                // 移动端拖拽功能
                fullscreenImage.addEventListener('touchstart', handleTouchStartDrag, { passive: false });
                fullscreenImage.addEventListener('touchmove', handleTouchMoveDrag, { passive: false });
                fullscreenImage.addEventListener('touchend', handleTouchEndDrag);
                
                // 移动端双击手势
                fullscreenImage.addEventListener('touchstart', handleTouchTap, { passive: false });
                
                // 双击重置缩放
                fullscreenImage.addEventListener('dblclick', resetZoom);
            }
            
            // 移除缩放功能事件监听
            function removeZoomListeners() {
                fullscreenImage.removeEventListener('wheel', handleWheelZoom);
                
                // 移除鼠标拖拽事件
                fullscreenImage.removeEventListener('mousedown', handleMouseDown);
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
                
                fullscreenImage.removeEventListener('touchstart', handleTouchStartZoom);
                fullscreenImage.removeEventListener('touchmove', handleTouchMoveZoom);
                fullscreenImage.removeEventListener('touchend', handleTouchEndZoom);
                
                // 移除移动端拖拽事件
                fullscreenImage.removeEventListener('touchstart', handleTouchStartDrag);
                fullscreenImage.removeEventListener('touchmove', handleTouchMoveDrag);
                fullscreenImage.removeEventListener('touchend', handleTouchEndDrag);
                
                // 移除移动端双击手势事件
                fullscreenImage.removeEventListener('touchstart', handleTouchTap);
                
                fullscreenImage.removeEventListener('dblclick', resetZoom);
            }
            
            // 鼠标滚轮缩放处理（基于指针位置）
            function handleWheelZoom(e) {
                e.preventDefault();
                
                const delta = e.deltaY > 0 ? -0.15 : 0.15; // 步进改为15%
                const newScale = Math.max(1, Math.min(3, scale + delta)); // 放大上限改为300%
                
                if (newScale !== scale) {
                    // 计算指针相对于图片的位置
                    const rect = fullscreenImage.getBoundingClientRect();
                    const offsetX = e.clientX - rect.left;
                    const offsetY = e.clientY - rect.top;
                    
                    // 计算缩放中心点（相对于图片中心）
                    const centerX = offsetX - rect.width / 2;
                    const centerY = offsetY - rect.height / 2;
                    
                    // 计算缩放后的偏移量
                    const scaleChange = newScale / scale;
                    translateX = centerX * (1 - scaleChange) + translateX * scaleChange;
                    translateY = centerY * (1 - scaleChange) + translateY * scaleChange;
                    
                    scale = newScale;
                    applyZoom();
                }
            }
            
            // 触摸缩放开始
            function handleTouchStartZoom(e) {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    initialDistance = Math.hypot(
                        touch2.clientX - touch1.clientX,
                        touch2.clientY - touch1.clientY
                    );
                }
            }
            
            // 触摸缩放移动
            function handleTouchMoveZoom(e) {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const currentDistance = Math.hypot(
                        touch2.clientX - touch1.clientX,
                        touch2.clientY - touch1.clientY
                    );
                    
                    if (initialDistance > 0) {
                        const scaleChange = currentDistance / initialDistance;
                        const newScale = Math.max(1, Math.min(3, scale * scaleChange)); // 放大上限改为300%
                        
                        if (newScale !== scale) {
                            scale = newScale;
                            applyZoom();
                        }
                    }
                }
            }
            
            // 触摸缩放结束
            function handleTouchEndZoom(e) {
                if (e.touches.length < 2) {
                    initialDistance = 0;
                }
            }
            
            // 移动端双击手势处理
            let lastTap = 0;
            function handleTouchTap(e) {
                if (e.touches.length === 1) {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 300 && tapLength > 0) {
                        // 双击事件
                        e.preventDefault();
                        if (isZoomed) {
                            // 如果已缩放，则重置到原始大小
                            resetZoom();
                        } else {
                            // 如果未缩放，则缩放到预设比例（2倍）
                            scale = 2;
                            applyZoom();
                        }
                    }
                    
                    lastTap = currentTime;
                }
            }
            
            // 应用缩放和位移
            function applyZoom(disableTransition = false) {
                if (disableTransition) {
                    fullscreenImage.style.transition = 'none';
                } else {
                    fullscreenImage.style.transition = 'transform 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                }
                
                fullscreenImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                isZoomed = scale > 1;
                
                if (isZoomed) {
                    fullscreenImage.classList.add('zoomed');
                } else {
                    fullscreenImage.classList.remove('zoomed');
                }
            }
            
            // 鼠标拖拽功能
            function handleMouseDown(e) {
                if (isZoomed) {
                    e.preventDefault();
                    isDragging = true;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    dragStartTranslateX = translateX;
                    dragStartTranslateY = translateY;
                    fullscreenImage.classList.add('dragging');
                    
                    // 重置拖拽范围缓存，确保每次拖拽都重新计算
                    window.maxTranslateX = null;
                    window.maxTranslateY = null;
                }
            }
            
            function handleMouseMove(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    // 使用requestAnimationFrame确保流畅的拖拽
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                    
                    animationFrameId = requestAnimationFrame(() => {
                        const deltaX = e.clientX - dragStartX;
                        const deltaY = e.clientY - dragStartY;
                        
                        translateX = dragStartTranslateX + deltaX;
                        translateY = dragStartTranslateY + deltaY;
                        
                        // 优化：只在拖拽开始时计算一次最大偏移量，避免重复计算
                        if (!window.maxTranslateX || !window.maxTranslateY) {
                            const rect = fullscreenImage.getBoundingClientRect();
                            const containerRect = fullscreenImage.parentElement.getBoundingClientRect();
                            window.maxTranslateX = Math.max(0, (rect.width * scale - containerRect.width) / 2);
                            window.maxTranslateY = Math.max(0, (rect.height * scale - containerRect.height) / 2);
                        }
                        
                        translateX = Math.max(-window.maxTranslateX, Math.min(window.maxTranslateX, translateX));
                        translateY = Math.max(-window.maxTranslateY, Math.min(window.maxTranslateY, translateY));
                        
                        // 拖拽时禁用过渡动画，确保实时响应
                        applyZoom(true);
                    });
                }
            }
            
            function handleMouseUp(e) {
                if (isDragging) {
                    isDragging = false;
                    fullscreenImage.classList.remove('dragging');
                    
                    // 清理动画帧
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    
                    // 拖拽结束后恢复过渡动画
                    applyZoom(false);
                }
            }
            
            // 移动端拖拽功能
            function handleTouchStartDrag(e) {
                if (isZoomed && e.touches.length === 1) {
                    e.preventDefault();
                    isDragging = true;
                    dragStartX = e.touches[0].clientX;
                    dragStartY = e.touches[0].clientY;
                    dragStartTranslateX = translateX;
                    dragStartTranslateY = translateY;
                    fullscreenImage.classList.add('dragging');
                    
                    // 重置拖拽范围缓存，确保每次拖拽都重新计算
                    window.maxTranslateX = null;
                    window.maxTranslateY = null;
                }
            }
            
            function handleTouchMoveDrag(e) {
                if (isDragging && e.touches.length === 1) {
                    e.preventDefault();
                    
                    // 使用requestAnimationFrame确保流畅的拖拽
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                    
                    animationFrameId = requestAnimationFrame(() => {
                        const deltaX = e.touches[0].clientX - dragStartX;
                        const deltaY = e.touches[0].clientY - dragStartY;
                        
                        translateX = dragStartTranslateX + deltaX;
                        translateY = dragStartTranslateY + deltaY;
                        
                        // 优化：使用缓存的拖拽范围限制，避免重复计算
                        if (!window.maxTranslateX || !window.maxTranslateY) {
                            const rect = fullscreenImage.getBoundingClientRect();
                            const containerRect = fullscreenImage.parentElement.getBoundingClientRect();
                            window.maxTranslateX = Math.max(0, (rect.width * scale - containerRect.width) / 2);
                            window.maxTranslateY = Math.max(0, (rect.height * scale - containerRect.height) / 2);
                        }
                        
                        translateX = Math.max(-window.maxTranslateX, Math.min(window.maxTranslateX, translateX));
                        translateY = Math.max(-window.maxTranslateY, Math.min(window.maxTranslateY, translateY));
                        
                        // 拖拽时禁用过渡动画，确保实时响应
                        applyZoom(true);
                    });
                }
            }
            
            function handleTouchEndDrag(e) {
                if (isDragging) {
                    isDragging = false;
                    fullscreenImage.classList.remove('dragging');
                    
                    // 清理动画帧
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    
                    // 拖拽结束后恢复过渡动画
                    applyZoom(false);
                }
            }
            
            // 根据图片比例优化容器尺寸 - 增强版，支持像素密度检测
            function optimizeContainerSize(imgWidth, imgHeight) {
                const container = document.querySelector('.fullscreen-viewer-image-container');
                const content = document.querySelector('.fullscreen-viewer-content');
                const fullscreenImage = document.getElementById('fullscreen-image');
                
                if (!container || !content || !fullscreenImage) return;
                
                // 检测设备像素密度
                const pixelRatio = window.devicePixelRatio || 1;
                const isHighDPI = pixelRatio >= 2;
                
                // 获取屏幕尺寸和方向
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const isPortrait = screenHeight > screenWidth;
                
                // 根据屏幕尺寸计算弹窗最大尺寸（90%屏幕宽×90%屏幕高）
                const maxViewerWidth = screenWidth * 0.9;
                const maxViewerHeight = screenHeight * 0.9;
                
                // 更新弹窗尺寸
                content.style.width = `${Math.min(maxViewerWidth, 1200)}px`;
                content.style.maxHeight = `${maxViewerHeight}px`;
                
                // 获取可用空间（考虑内边距和边距）
                const contentStyle = window.getComputedStyle(content);
                const paddingLeft = parseFloat(contentStyle.paddingLeft) || 0;
                const paddingRight = parseFloat(contentStyle.paddingRight) || 0;
                const paddingTop = parseFloat(contentStyle.paddingTop) || 0;
                const paddingBottom = parseFloat(contentStyle.paddingBottom) || 0;
                
                // 获取信息区域高度
                const infoElement = document.querySelector('.fullscreen-viewer-info');
                const infoHeight = infoElement ? infoElement.offsetHeight : 60;
                
                // 计算图片容器可用空间
                const availableWidth = content.clientWidth - paddingLeft - paddingRight;
                const availableHeight = maxViewerHeight - paddingTop - paddingBottom - infoHeight - 20; // 20px安全边距
                
                // 计算图片比例
                const imgRatio = imgWidth / imgHeight;
                const containerRatio = availableWidth / availableHeight;
                
                // 根据设备类型和屏幕尺寸进行智能适配
                const isMobile = screenWidth <= 768;
                const isTablet = screenWidth > 768 && screenWidth <= 1024;
                const isDesktop = screenWidth > 1024;
                
                // 重置容器样式
                container.style.width = `${availableWidth}px`;
                container.style.height = `${availableHeight}px`;
                container.style.maxWidth = `${availableWidth}px`;
                container.style.maxHeight = `${availableHeight}px`;
                
                // 计算图片最佳显示尺寸
                let displayWidth, displayHeight;
                
                if (imgRatio > containerRatio) {
                    // 图片比容器更宽，以宽度为基准
                    displayWidth = availableWidth - 20; // 10px左右边距
                    displayHeight = displayWidth / imgRatio;
                } else {
                    // 图片比容器更高，以高度为基准
                    displayHeight = availableHeight - 20; // 10px上下边距
                    displayWidth = displayHeight * imgRatio;
                }
                
                // 确保图片尺寸不超过原始尺寸
                displayWidth = Math.min(displayWidth, imgWidth);
                displayHeight = Math.min(displayHeight, imgHeight);
                
                // 设置图片显示尺寸
                fullscreenImage.style.width = `${displayWidth}px`;
                fullscreenImage.style.height = `${displayHeight}px`;
                fullscreenImage.style.maxWidth = `${displayWidth}px`;
                fullscreenImage.style.maxHeight = `${displayHeight}px`;
                
                // 高DPI设备图片渲染优化
                if (isHighDPI) {
                    fullscreenImage.style.imageRendering = 'crisp-edges';
                } else {
                    fullscreenImage.style.imageRendering = 'auto';
                }
            }
            
            // 重置缩放
            function resetZoom() {
                scale = 1;
                translateX = 0;
                translateY = 0;
                applyZoom();
            }
            
            // 关闭查看器
            function closeViewer() {
                const viewerContent = document.querySelector('.fullscreen-viewer-content');
                
                // 移除缩放事件监听器
                removeZoomListeners();
                
                // 移除之前的过渡效果，避免冲突
                viewerContent.style.transition = '';
                
                // 添加关闭动画 - 先缩放再淡出
                viewerContent.style.transform = 'translate(-50%, -50%) scale(0.8)';
                viewerContent.style.opacity = '0';
                viewerContent.style.transition = 'transform 0.25s ease, opacity 0.25s ease';
                
                // 延迟移除active类以完成动画
                setTimeout(() => {
                    fullscreenViewer.classList.remove('active');
                    // 重置所有样式
                    viewerContent.style.transition = '';
                    viewerContent.style.transform = '';
                    viewerContent.style.opacity = '';
                    viewerContent.style.left = '';
                    viewerContent.style.top = '';
                    
                    // 重置缩放状态
                    scale = 1;
                    isZoomed = false;
                    translateX = 0;
                    translateY = 0;
                    isDragging = false;
                    fullscreenImage.style.transform = '';
                    fullscreenImage.classList.remove('zoomed');
                    fullscreenImage.classList.remove('dragging');
                    
                    // 恢复页面滚动位置
                    if (window.savedScrollPosition) {
                        window.scrollTo(window.savedScrollPosition.x, window.savedScrollPosition.y);
                        window.savedScrollPosition = null;
                    }
                    
                    // 恢复页面滚动
                    document.body.style.overflow = '';
                }, 250);
            }
            
            // 防抖函数 - 优化性能
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // 窗口大小变化时的动态适配（带防抖）
            function handleWindowResize() {
                if (fullscreenViewer.classList.contains('active')) {
                    // 重新计算当前图片的适配
                    const currentImage = currentImages[currentIndex];
                    if (currentImage) {
                        const tempImg = new Image();
                        tempImg.onload = function() {
                            optimizeContainerSize(tempImg.width, tempImg.height);
                            // 重置缩放状态以适应新的容器尺寸
                            resetZoom();
                            
                            // 重新计算弹窗位置，确保在视口中心
                            const viewerContent = document.querySelector('.fullscreen-viewer-content');
                            if (viewerContent) {
                                const viewportWidth = window.innerWidth;
                                const viewportHeight = window.innerHeight;
                                const contentWidth = viewerContent.offsetWidth;
                                const contentHeight = viewerContent.offsetHeight;
                                
                                // 计算居中位置
                                const centerX = viewportWidth / 2;
                                const centerY = viewportHeight / 2;
                                
                                // 设置弹窗位置
                                viewerContent.style.left = `${centerX}px`;
                                viewerContent.style.top = `${centerY}px`;
                                viewerContent.style.transform = 'translate(-50%, -50%)';
                            }
                        };
                        tempImg.src = currentImage.src;
                    }
                }
            }
            
            // 添加窗口大小变化监听器（带防抖，250ms）
            window.addEventListener('resize', debounce(handleWindowResize, 250));
            
            // 添加屏幕方向变化监听器
            window.addEventListener('orientationchange', debounce(handleWindowResize, 250));
            
            // 预加载优化 - 智能预加载相邻图片
            function preloadAdjacentImages() {
                const preloadCount = 2; // 预加载前后各2张图片
                
                for (let i = 1; i <= preloadCount; i++) {
                    // 预加载前i张图片
                    const prevIndex = (currentIndex - i + currentImages.length) % currentImages.length;
                    const prevImage = currentImages[prevIndex];
                    if (prevImage) {
                        const img = new Image();
                        img.src = prevImage.src;
                    }
                    
                    // 预加载后i张图片
                    const nextIndex = (currentIndex + i) % currentImages.length;
                    const nextImage = currentImages[nextIndex];
                    if (nextImage) {
                        const img = new Image();
                        img.src = nextImage.src;
                    }
                }
            }
            
            // 更新查看器内容
            function updateViewer() {
                const image = currentImages[currentIndex];
                
                // 预加载图片以确保平滑显示
                const img = new Image();
                img.onload = function() {
                    fullscreenImage.src = image.src;
                    fullscreenImage.alt = image.alt;
                    fullscreenTitle.textContent = image.alt;
                    fullscreenCaption.textContent = image.caption;
                    fullscreenIndex.textContent = `${currentIndex + 1} / ${currentImages.length}`;
                    
                    // 根据图片实际比例优化容器尺寸
                    optimizeContainerSize(img.width, img.height);
                    
                    // 重置缩放状态
                    resetZoom();
                    
                    // 智能预加载相邻图片
                    preloadAdjacentImages();
                    
                    // 确保图片完全加载后再显示
                    fullscreenImage.style.opacity = '1';
                };
                img.onerror = function() {
                    // 如果图片加载失败，使用备用显示
                    fullscreenImage.src = image.src;
                    fullscreenImage.alt = image.alt;
                    fullscreenTitle.textContent = image.alt;
                    fullscreenCaption.textContent = image.caption;
                    fullscreenIndex.textContent = `${currentIndex + 1} / ${currentImages.length}`;
                    resetZoom();
                };
                
                // 开始加载图片
                fullscreenImage.style.opacity = '0.7'; // 加载时显示半透明效果
                img.src = image.src;
            }
            
            // 上一张图片
            function showPrevImage() {
                // 添加向左滑动的动画效果
                fullscreenImage.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                fullscreenImage.style.transform = 'translateX(100%)';
                
                // 禁用缩放功能，避免动画冲突
                removeZoomListeners();
                
                setTimeout(() => {
                    currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
                    
                    // 临时修改updateViewer，在图片加载后添加反向动画
                    const originalUpdateViewer = updateViewer;
                    updateViewer = function() {
                        const image = currentImages[currentIndex];
                        
                        // 预加载图片以确保平滑显示
                        const img = new Image();
                        img.onload = function() {
                            // 立即更新图片，无过渡效果
                            fullscreenImage.style.transition = 'none';
                            fullscreenImage.style.transform = 'translateX(-100%)';
                            fullscreenImage.style.opacity = '0';
                            
                            // 强制重排
                            void fullscreenImage.offsetWidth;
                            
                            // 更新图片信息
                            fullscreenImage.src = image.src;
                            fullscreenImage.alt = image.alt;
                            fullscreenTitle.textContent = image.alt;
                            fullscreenCaption.textContent = image.caption;
                            fullscreenIndex.textContent = `${currentIndex + 1} / ${currentImages.length}`;
                            
                            // 根据图片实际比例优化容器尺寸
                            optimizeContainerSize(img.width, img.height);
                            
                            // 重置缩放状态
                            resetZoom();
                            
                            // 智能预加载相邻图片
                            preloadAdjacentImages();
                            
                            // 添加进入动画
                            setTimeout(() => {
                                fullscreenImage.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.5s ease';
                                fullscreenImage.style.transform = 'translateX(0)';
                                fullscreenImage.style.opacity = '1';
                                
                                // 动画完成后恢复原始函数和缩放功能
                                setTimeout(() => {
                                    updateViewer = originalUpdateViewer;
                                    addZoomListeners();
                                }, 500);
                            }, 50);
                        };
                        img.onerror = function() {
                            // 如果图片加载失败，恢复原始函数和缩放功能
                            updateViewer = originalUpdateViewer;
                            addZoomListeners();
                            originalUpdateViewer();
                        };
                        
                        // 开始加载图片
                        img.src = image.src;
                    };
                    
                    // 调用修改后的updateViewer
                    updateViewer();
                }, 500);
            }
            
            // 下一张图片
            function showNextImage() {
                // 添加向右滑动的动画效果
                fullscreenImage.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                fullscreenImage.style.transform = 'translateX(-100%)';
                
                // 禁用缩放功能，避免动画冲突
                removeZoomListeners();
                
                setTimeout(() => {
                    currentIndex = (currentIndex + 1) % currentImages.length;
                    
                    // 临时修改updateViewer，在图片加载后添加反向动画
                    const originalUpdateViewer = updateViewer;
                    updateViewer = function() {
                        const image = currentImages[currentIndex];
                        
                        // 预加载图片以确保平滑显示
                        const img = new Image();
                        img.onload = function() {
                            // 立即更新图片，无过渡效果
                            fullscreenImage.style.transition = 'none';
                            fullscreenImage.style.transform = 'translateX(100%)';
                            fullscreenImage.style.opacity = '0';
                            
                            // 强制重排
                            void fullscreenImage.offsetWidth;
                            
                            // 更新图片信息
                            fullscreenImage.src = image.src;
                            fullscreenImage.alt = image.alt;
                            fullscreenTitle.textContent = image.alt;
                            fullscreenCaption.textContent = image.caption;
                            fullscreenIndex.textContent = `${currentIndex + 1} / ${currentImages.length}`;
                            
                            // 根据图片实际比例优化容器尺寸
                            optimizeContainerSize(img.width, img.height);
                            
                            // 重置缩放状态
                            resetZoom();
                            
                            // 智能预加载相邻图片
                            preloadAdjacentImages();
                            
                            // 添加进入动画
                            setTimeout(() => {
                                fullscreenImage.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.5s ease';
                                fullscreenImage.style.transform = 'translateX(0)';
                                fullscreenImage.style.opacity = '1';
                                
                                // 动画完成后恢复原始函数和缩放功能
                                setTimeout(() => {
                                    updateViewer = originalUpdateViewer;
                                    addZoomListeners();
                                }, 500);
                            }, 50);
                        };
                        img.onerror = function() {
                            // 如果图片加载失败，恢复原始函数和缩放功能
                            updateViewer = originalUpdateViewer;
                            addZoomListeners();
                            originalUpdateViewer();
                        };
                        
                        // 开始加载图片
                        img.src = image.src;
                    };
                    
                    // 调用修改后的updateViewer
                    updateViewer();
                }, 500);
            }
            
            // 触摸事件处理
            function handleTouchStart(e) {
                touchStartX = e.changedTouches[0].screenX;
            }
            
            function handleTouchEnd(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }
            
            function handleSwipe() {
                const threshold = 50;
                if (touchEndX < touchStartX - threshold) {
                    // 向左滑动，显示下一张
                    showNextImage();
                }
                if (touchEndX > touchStartX + threshold) {
                    // 向右滑动，显示上一张
                    showPrevImage();
                }
            }
            
            // 触摸事件 - 滑动切换图片
            fullscreenImage.addEventListener('touchstart', handleTouchStart);
            fullscreenImage.addEventListener('touchend', handleTouchEnd);
            
            // 点击图片左右两侧区域切换图片
            const imageContainer = document.querySelector('.fullscreen-viewer-image-container');
            imageContainer.addEventListener('click', function(e) {
                const rect = imageContainer.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const containerWidth = rect.width;
                
                // 左侧20%区域点击 - 显示上一张
                if (clickX < containerWidth * 0.2) {
                    showPrevImage();
                }
                // 右侧20%区域点击 - 显示下一张
                else if (clickX > containerWidth * 0.8) {
                    showNextImage();
                }
            });
            
            // 鼠标悬停在左右两侧区域时显示提示信息
            imageContainer.addEventListener('mousemove', function(e) {
                const rect = imageContainer.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const containerWidth = rect.width;
                
                const prevHint = document.querySelector('.fullscreen-nav-hint-prev');
                const nextHint = document.querySelector('.fullscreen-nav-hint-next');
                
                // 左侧20%区域显示上一张提示
                if (prevHint) {
                    if (mouseX < containerWidth * 0.2) {
                        prevHint.style.opacity = '1';
                    } else {
                        prevHint.style.opacity = '0';
                    }
                }
                
                // 右侧20%区域显示下一张提示
                if (nextHint) {
                    if (mouseX > containerWidth * 0.8) {
                        nextHint.style.opacity = '1';
                    } else {
                        nextHint.style.opacity = '0';
                    }
                }
            });
            
            // 鼠标离开时隐藏提示信息
            imageContainer.addEventListener('mouseleave', function() {
                const prevHint = document.querySelector('.fullscreen-nav-hint-prev');
                const nextHint = document.querySelector('.fullscreen-nav-hint-next');
                
                if (prevHint) {
                    prevHint.style.opacity = '0';
                }
                
                if (nextHint) {
                    nextHint.style.opacity = '0';
                }
            });
            
            // 点击弹窗外空白区域关闭弹窗
            fullscreenViewer.addEventListener('click', function(e) {
                if (e.target === fullscreenViewer) {
                    closeViewer();
                }
            });
            
            // 防止点击内容区域触发关闭
            viewerContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // 键盘事件
            document.addEventListener('keydown', function(e) {
                if (!fullscreenViewer.classList.contains('active')) return;
                
                switch(e.key) {
                    case 'Escape':
                        closeViewer();
                        break;
                    case 'ArrowLeft':
                        showPrevImage();
                        break;
                    case 'ArrowRight':
                        showNextImage();
                        break;
                }
            });
        }

        // 页面加载完成后初始化所有功能
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
    </script>

    <!-- 全屏查看器 -->
    <div id="fullscreen-viewer" class="fullscreen-viewer">
        <div class="fullscreen-viewer-content">
            <div class="fullscreen-viewer-image-container">
                <img id="fullscreen-image" src="" alt="" class="fullscreen-viewer-image">
                <!-- 左右两侧提示元素 -->
                <div class="fullscreen-nav-hint fullscreen-nav-hint-prev">上一张</div>
                <div class="fullscreen-nav-hint fullscreen-nav-hint-next">下一张</div>
            </div>
            <div class="fullscreen-viewer-info">
                <span id="fullscreen-index">0/0</span>
                <h3 id="fullscreen-title"></h3>
                <p id="fullscreen-caption"></p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-[#0A0A0F] py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 JUNJUN摄影。保留所有权利。</p>
        </div>
    </footer>
</body>
</html>